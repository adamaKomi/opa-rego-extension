{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Rego",
  "scopeName": "source.rego",
  "fileTypes": ["rego"],
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#raw-strings" },
    { "include": "#package-declaration" },
    { "include": "#import-declaration" },
    { "include": "#rule-definition" },
    { "include": "#keywords" },
    { "include": "#constants" },
    { "include": "#operators" },
    { "include": "#builtin-functions" },
    { "include": "#variables" },
    { "include": "#numbers" },
    { "include": "#punctuation" }
  ],
  "repository": {
    "comments": {
      "name": "comment.line.number-sign.rego",
      "match": "#.*$"
    },
    "strings": {
      "name": "string.quoted.double.rego",
      "begin": "\"",
      "end": "\"",
      "patterns": [
        {
          "name": "constant.character.escape.rego",
          "match": "\\\\(?:[\"\\\\bfnrt]|u[0-9a-fA-F]{4})"
        }
      ]
    },
    "raw-strings": {
      "name": "string.quoted.raw.rego",
      "begin": "`",
      "end": "`"
    },
    "package-declaration": {
      "match": "^\\s*(package)\\s+([a-zA-Z_][a-zA-Z0-9_]*(\\.[a-zA-Z_][a-zA-Z0-9_]*)*)",
      "captures": {
        "1": { "name": "keyword.control.package.rego" },
        "2": { "name": "entity.name.namespace.rego" }
      }
    },
    "import-declaration": {
      "match": "^\\s*(import)\\s+(future\\.keywords\\.[a-zA-Z_]+|data|input|[a-zA-Z_][a-zA-Z0-9_.]*)(\\s+(as)\\s+([a-zA-Z_][a-zA-Z0-9_]*))?",
      "captures": {
        "1": { "name": "keyword.control.import.rego" },
        "2": { "name": "entity.name.import.rego" },
        "4": { "name": "keyword.control.as.rego" },
        "5": { "name": "entity.name.alias.rego" }
      }
    },
    "rule-definition": {
      "match": "^\\s*([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\[|\\(|\\{|:=|=|if)",
      "captures": {
        "1": { "name": "entity.name.function.rule.rego" }
      }
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.rego",
          "match": "\\b(if|else|not|with|as|default|some|every|in|contains)\\b"
        },
        {
          "name": "keyword.other.rego",
          "match": "\\b(package|import)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.boolean.rego",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "constant.language.null.rego",
          "match": "\\b(null)\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.assignment.rego",
          "match": ":=|="
        },
        {
          "name": "keyword.operator.comparison.rego",
          "match": "==|!=|<=|>=|<|>"
        },
        {
          "name": "keyword.operator.arithmetic.rego",
          "match": "\\+|-|\\*|/|%"
        },
        {
          "name": "keyword.operator.logical.rego",
          "match": "&|\\|"
        }
      ]
    },
    "builtin-functions": {
      "patterns": [
        {
          "name": "support.function.aggregate.rego",
          "match": "\\b(count|sum|product|max|min|sort|all|any)\\b"
        },
        {
          "name": "support.function.string.rego",
          "match": "\\b(concat|contains|endswith|format_int|indexof|lower|replace|split|sprintf|startswith|substring|trim|trim_left|trim_prefix|trim_right|trim_suffix|trim_space|upper)\\b"
        },
        {
          "name": "support.function.regex.rego",
          "match": "\\b(regex\\.match|regex\\.split|regex\\.globs_match|regex\\.template_match|regex\\.find_n|regex\\.find_all_string_submatch_n)\\b"
        },
        {
          "name": "support.function.array.rego",
          "match": "\\b(array\\.concat|array\\.slice)\\b"
        },
        {
          "name": "support.function.set.rego",
          "match": "\\b(intersection|union)\\b"
        },
        {
          "name": "support.function.object.rego",
          "match": "\\b(object\\.get|object\\.remove|object\\.union|object\\.filter|json\\.marshal|json\\.unmarshal)\\b"
        },
        {
          "name": "support.function.type.rego",
          "match": "\\b(is_array|is_boolean|is_null|is_number|is_object|is_set|is_string|type_name)\\b"
        },
        {
          "name": "support.function.encoding.rego",
          "match": "\\b(base64\\.encode|base64\\.decode|base64url\\.encode|base64url\\.decode|urlquery\\.encode|urlquery\\.decode|urlquery\\.encode_object)\\b"
        },
        {
          "name": "support.function.token.rego",
          "match": "\\b(io\\.jwt\\.encode_sign|io\\.jwt\\.encode_sign_raw|io\\.jwt\\.decode|io\\.jwt\\.decode_verify|io\\.jwt\\.verify_es256|io\\.jwt\\.verify_es384|io\\.jwt\\.verify_es512|io\\.jwt\\.verify_hs256|io\\.jwt\\.verify_hs384|io\\.jwt\\.verify_hs512|io\\.jwt\\.verify_ps256|io\\.jwt\\.verify_ps384|io\\.jwt\\.verify_ps512|io\\.jwt\\.verify_rs256|io\\.jwt\\.verify_rs384|io\\.jwt\\.verify_rs512)\\b"
        },
        {
          "name": "support.function.time.rego",
          "match": "\\b(time\\.now_ns|time\\.parse_ns|time\\.parse_rfc3339_ns|time\\.parse_duration_ns|time\\.date|time\\.clock|time\\.weekday|time\\.add_date)\\b"
        },
        {
          "name": "support.function.crypto.rego",
          "match": "\\b(crypto\\.sha256|crypto\\.md5|crypto\\.hmac\\.md5|crypto\\.hmac\\.sha1|crypto\\.hmac\\.sha256|crypto\\.hmac\\.sha512)\\b"
        },
        {
          "name": "support.function.graph.rego",
          "match": "\\b(graph\\.reachable|walk)\\b"
        },
        {
          "name": "support.function.http.rego",
          "match": "\\b(http\\.send)\\b"
        },
        {
          "name": "support.function.net.rego",
          "match": "\\b(net\\.cidr_contains|net\\.cidr_intersects|net\\.cidr_expand|net\\.cidr_merge)\\b"
        },
        {
          "name": "support.function.rego.rego",
          "match": "\\b(rego\\.parse_module)\\b"
        },
        {
          "name": "support.function.opa.rego",
          "match": "\\b(opa\\.runtime)\\b"
        },
        {
          "name": "support.function.tracing.rego",
          "match": "\\b(trace|print)\\b"
        },
        {
          "name": "support.function.numbers.rego",
          "match": "\\b(abs|ceil|floor|round|numbers\\.range)\\b"
        },
        {
          "name": "support.function.bits.rego",
          "match": "\\b(bits\\.or|bits\\.and|bits\\.negate|bits\\.xor|bits\\.lsh|bits\\.rsh)\\b"
        },
        {
          "name": "support.function.conversion.rego",
          "match": "\\b(to_number)\\b"
        },
        {
          "name": "support.function.units.rego",
          "match": "\\b(units\\.parse|units\\.parse_bytes)\\b"
        },
        {
          "name": "support.function.uuid.rego",
          "match": "\\b(uuid\\.rfc4122)\\b"
        },
        {
          "name": "support.function.semver.rego",
          "match": "\\b(semver\\.is_valid|semver\\.compare)\\b"
        },
        {
          "name": "support.function.glob.rego",
          "match": "\\b(glob\\.match|glob\\.quote_meta)\\b"
        }
      ]
    },
    "variables": {
      "patterns": [
        {
          "name": "variable.language.input.rego",
          "match": "\\b(input)\\b"
        },
        {
          "name": "variable.language.data.rego",
          "match": "\\b(data)\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.float.rego",
          "match": "\\b\\d+\\.\\d+([eE][+-]?\\d+)?\\b"
        },
        {
          "name": "constant.numeric.integer.rego",
          "match": "\\b\\d+\\b"
        }
      ]
    },
    "punctuation": {
      "patterns": [
        {
          "name": "punctuation.separator.rego",
          "match": "[,;]"
        },
        {
          "name": "punctuation.accessor.rego",
          "match": "\\."
        },
        {
          "name": "punctuation.definition.block.rego",
          "match": "[{}]"
        },
        {
          "name": "punctuation.definition.array.rego",
          "match": "[\\[\\]]"
        },
        {
          "name": "punctuation.definition.parameters.rego",
          "match": "[()]"
        }
      ]
    }
  }
}
